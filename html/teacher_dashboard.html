<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>教师控制面板 - 个性化学习路径的在线课程管理系统</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- 引入自定义样式 -->
  <link rel="stylesheet" href="../assets/css/style.css">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4361ee',
            secondary: '#3a0ca3',
            success: '#4cc9f0',
            warning: '#f72585',
            danger: '#ff0054',
            'text-primary': '#2b2d42',
            'text-secondary': '#8d99ae',
            'bg-light': '#edf2f4',
          },
          fontFamily: {
            sans: ['Segoe UI', 'Tahoma', 'Geneva', 'Verdana', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-hover {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .card-hover:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- 顶部导航栏 -->
  <nav class="bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <!-- 左侧Logo和名称 -->
        <div class="flex items-center">
          <a href="#" class="flex-shrink-0 flex items-center">
            <i class="fa fa-graduation-cap text-primary text-2xl mr-2"></i>
            <span class="font-bold text-lg text-primary">学习路径系统</span>
          </a>
          
          <!-- 导航链接 - 中等屏幕以上显示 -->
          <div class="hidden md:ml-10 md:flex md:space-x-8">
            <a href="teacher_dashboard.html" class="border-primary text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              <i class="fa fa-dashboard mr-2"></i>
              控制面板
            </a>
            <a href="teacher_courses.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              <i class="fa fa-book mr-2"></i>
              我的课程
            </a>
            <a href="teacher_assignments.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              <i class="fa fa-file-text mr-2"></i>
              作业管理
            </a>
            <a href="teacher_students.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
              <i class="fa fa-users mr-2"></i>
              学生管理
            </a>
          </div>
        </div>
        
        <!-- 右侧用户信息和操作 -->
        <div class="flex items-center">
          <!-- 搜索框 -->
          <div class="hidden md:block">
            <div class="ml-3 relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-search text-gray-400"></i>
              </div>
              <input class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-400 focus:outline-none focus:ring-primary focus:border-primary" placeholder="搜索...">
            </div>
          </div>
          
          <!-- 通知图标 -->
          <div class="ml-3 relative">
            <button class="text-gray-500 hover:text-gray-700 focus:outline-none">
              <i class="fa fa-bell text-xl"></i>
              <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">7</span>
            </button>
          </div>
          
          <!-- 用户头像 -->
          <div class="ml-3 relative">
            <div class="flex items-center">
              <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1005/200/200" alt="用户头像">
              <span class="ml-2 text-sm font-medium text-gray-700">李教授</span>
              <i class="fa fa-chevron-down ml-1 text-xs text-gray-500"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- 主内容区 -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- 页面标题 -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold text-gray-900">教师控制面板</h1>
      <p class="text-gray-600 mt-1">欢迎回来，李教授！这是你的教学概览</p>
    </div>
    
    <!-- 统计卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- 课程数量 -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0 bg-blue-100 rounded-md p-3">
              <i class="fa fa-book text-blue-600 text-xl"></i>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">教授课程</dt>
                <dd>
                  <div class="text-lg font-semibold text-gray-900">5</div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="mt-5 bg-gray-50 px-5 py-3 rounded-md">
            <div class="text-sm">
              <a href="teacher_courses.html" class="font-medium text-primary hover:text-primary/80">
                查看所有课程
                <i class="fa fa-arrow-right ml-1"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 学生数量 -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0 bg-green-100 rounded-md p-3">
              <i class="fa fa-users text-green-600 text-xl"></i>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">授课学生</dt>
                <dd>
                  <div class="text-lg font-semibold text-gray-900">128</div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="mt-5 bg-gray-50 px-5 py-3 rounded-md">
            <div class="text-sm">
              <a href="teacher_students.html" class="font-medium text-primary hover:text-primary/80">
                查看所有学生
                <i class="fa fa-arrow-right ml-1"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 待批改作业 -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0 bg-yellow-100 rounded-md p-3">
              <i class="fa fa-file-text-o text-yellow-600 text-xl"></i>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">待批改作业</dt>
                <dd>
                  <div class="text-lg font-semibold text-gray-900">12</div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="mt-5 bg-gray-50 px-5 py-3 rounded-md">
            <div class="text-sm">
              <a href="teacher_assignments.html" class="font-medium text-primary hover:text-primary/80">
                立即批改
                <i class="fa fa-arrow-right ml-1"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 学习风险预警 -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover">
        <div class="p-6">
          <div class="flex items-center">
            <div class="flex-shrink-0 bg-red-100 rounded-md p-3">
              <i class="fa fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <div class="ml-5 w-0 flex-1">
              <dl>
                <dt class="text-sm font-medium text-gray-500 truncate">风险预警</dt>
                <dd>
                  <div class="text-lg font-semibold text-gray-900">5</div>
                </dd>
              </dl>
            </div>
          </div>
          <div class="mt-5 bg-gray-50 px-5 py-3 rounded-md">
            <div class="text-sm">
              <a href="#" class="font-medium text-primary hover:text-primary/80">
                查看详情
                <i class="fa fa-arrow-right ml-1"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 主要内容区域 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 左侧：近期活动 -->
      <div class="lg:col-span-2 space-y-6">
        <!-- 最近活动 -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-bold text-gray-900">最近活动</h2>
              <a href="#" class="text-sm font-medium text-primary hover:text-primary/80">
                查看全部
              </a>
            </div>
          </div>
          <div class="p-6">
            <div class="flow-root">
              <ul class="-my-5 divide-y divide-gray-200">
                <li class="py-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                      <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1012/200/200" alt="用户头像">
                    </div>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm text-gray-700">
                        <a href="#" class="font-medium text-gray-900">王小明</a>
                        提交了作业
                        <a href="#" class="font-medium text-primary">《极限与连续综合练习》</a>
                      </p>
                      <p class="text-sm text-gray-500 mt-1">2小时前</p>
                    </div>
                  </div>
                </li>
                <li class="py-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                      <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1027/200/200" alt="用户头像">
                    </div>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm text-gray-700">
                        <a href="#" class="font-medium text-gray-900">李小华</a>
                        提交了作业
                        <a href="#" class="font-medium text-primary">《矩阵运算与行列式计算》</a>
                      </p>
                      <p class="text-sm text-gray-500 mt-1">3小时前</p>
                    </div>
                  </div>
                </li>
                <li class="py-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                      <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1025/200/200" alt="用户头像">
                    </div>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm text-gray-700">
                        <a href="#" class="font-medium text-gray-900">张小红</a>
                        在课程
                        <a href="#" class="font-medium text-primary">《高等数学》</a>
                        中提出了一个问题
                      </p>
                      <p class="text-sm text-gray-500 mt-1">昨天</p>
                    </div>
                  </div>
                </li>
                <li class="py-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                      <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1066/200/200" alt="用户头像">
                    </div>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm text-gray-700">
                        <a href="#" class="font-medium text-gray-900">赵小刚</a>
                        提交了作业
                        <a href="#" class="font-medium text-primary">《古典概率与条件概率》</a>
                      </p>
                      <p class="text-sm text-gray-500 mt-1">昨天</p>
                    </div>
                  </div>
                </li>
                <li class="py-4">
                  <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                      <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1074/200/200" alt="用户头像">
                    </div>
                    <div class="min-w-0 flex-1">
                      <p class="text-sm text-gray-700">
                        <a href="#" class="font-medium text-gray-900">陈小明</a>
                        在课程
                        <a href="#" class="font-medium text-primary">《线性代数》</a>
                        中提出了一个问题
                      </p>
                      <p class="text-sm text-gray-500 mt-1">2天前</p>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        
        <!-- 即将截止的作业 -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-bold text-gray-900">即将截止的作业</h2>
              <a href="teacher_assignments.html" class="text-sm font-medium text-primary hover:text-primary/80">
                查看全部
              </a>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- 作业1 -->
              <div class="flex items-center p-3 bg-gray-50 rounded-md">
                <div class="flex-shrink-0 bg-red-100 rounded-full p-2">
                  <i class="fa fa-file-text-o text-red-600"></i>
                </div>
                <div class="ml-4 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">极限与连续综合练习</h3>
                  <p class="text-xs text-gray-500">高等数学 | 截止日期：2023-10-16 23:59</p>
                </div>
                <div class="flex-shrink-0">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    明天截止
                  </span>
                </div>
              </div>
              
              <!-- 作业2 -->
              <div class="flex items-center p-3 bg-gray-50 rounded-md">
                <div class="flex-shrink-0 bg-yellow-100 rounded-full p-2">
                  <i class="fa fa-file-text-o text-yellow-600"></i>
                </div>
                <div class="ml-4 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">矩阵运算与行列式计算</h3>
                  <p class="text-xs text-gray-500">线性代数 | 截止日期：2023-10-17 23:59</p>
                </div>
                <div class="flex-shrink-0">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    后天截止
                  </span>
                </div>
              </div>
              
              <!-- 作业3 -->
              <div class="flex items-center p-3 bg-gray-50 rounded-md">
                <div class="flex-shrink-0 bg-yellow-100 rounded-full p-2">
                  <i class="fa fa-file-text-o text-yellow-600"></i>
                </div>
                <div class="ml-4 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">古典概率与条件概率</h3>
                  <p class="text-xs text-gray-500">概率论与数理统计 | 截止日期：2023-10-17 23:59</p>
                </div>
                <div class="flex-shrink-0">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    后天截止
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 右侧：教学数据和学习风险 -->
      <div class="space-y-6">
        <!-- 教学数据概览 -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-bold text-gray-900">教学数据概览</h2>
          </div>
          <div class="p-6">
            <!-- 图表占位 -->
            <div class="h-64 relative">
              <!-- 模拟图表 -->
              <svg class="w-full h-full" viewBox="0 0 300 200">
                <path d="M0,180 L40,170 L80,160 L120,140 L160,130 L200,120 L240,110 L280,100 L300,90" fill="none" stroke="#4361ee" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M0,180 L40,170 L80,160 L120,140 L160,130 L200,120 L240,110 L280,100 L300,90" fill="rgba(67, 97, 238, 0.1)" stroke="none"/>
                
                <!-- 数据点 -->
                <circle cx="0" cy="180" r="3" fill="#4361ee"/>
                <circle cx="40" cy="170" r="3" fill="#4361ee"/>
                <circle cx="80" cy="160" r="3" fill="#4361ee"/>
                <circle cx="120" cy="140" r="3" fill="#4361ee"/>
                <circle cx="160" cy="130" r="3" fill="#4361ee"/>
                <circle cx="200" cy="120" r="3" fill="#4361ee"/>
                <circle cx="240" cy="110" r="3" fill="#4361ee"/>
                <circle cx="280" cy="100" r="3" fill="#4361ee"/>
                <circle cx="300" cy="90" r="3" fill="#4361ee"/>
              </svg>
            </div>
            
            <div class="mt-4 grid grid-cols-2 gap-4">
              <div class="bg-gray-50 rounded-md p-3">
                <h3 class="text-xs font-medium text-gray-500">平均出勤率</h3>
                <p class="text-lg font-semibold text-gray-900">92%</p>
              </div>
              <div class="bg-gray-50 rounded-md p-3">
                <h3 class="text-xs font-medium text-gray-500">作业提交率</h3>
                <p class="text-lg font-semibold text-gray-900">88%</p>
              </div>
              <div class="bg-gray-50 rounded-md p-3">
                <h3 class="text-xs font-medium text-gray-500">平均测验成绩</h3>
                <p class="text-lg font-semibold text-gray-900">85</p>
              </div>
              <div class="bg-gray-50 rounded-md p-3">
                <h3 class="text-xs font-medium text-gray-500">互动参与度</h3>
                <p class="text-lg font-semibold text-gray-900">76%</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 学习风险预警 -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-bold text-gray-900">学习风险预警</h2>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- 风险学生1 -->
              <div class="flex items-center p-3 bg-red-50 rounded-md">
                <div class="flex-shrink-0">
                  <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1012/200/200" alt="用户头像">
                </div>
                <div class="ml-3 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">王小明</h3>
                  <p class="text-xs text-gray-500">高等数学 | 35%挂科风险</p>
                </div>
                <div class="flex-shrink-0">
                  <button class="risk-detail-btn inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 hover:bg-red-200">
                    详情
                  </button>
                </div>
              </div>
              
              <!-- 风险学生2 -->
              <div class="flex items-center p-3 bg-yellow-50 rounded-md">
                <div class="flex-shrink-0">
                  <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1074/200/200" alt="用户头像">
                </div>
                <div class="ml-3 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">陈小明</h3>
                  <p class="text-xs text-gray-500">线性代数 | 28%挂科风险</p>
                </div>
                <div class="flex-shrink-0">
                  <button class="risk-detail-btn inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 hover:bg-yellow-200">
                    详情
                  </button>
                </div>
              </div>
              
              <!-- 风险学生3 -->
              <div class="flex items-center p-3 bg-yellow-50 rounded-md">
                <div class="flex-shrink-0">
                  <img class="h-8 w-8 rounded-full object-cover" src="https://picsum.photos/id/1066/200/200" alt="用户头像">
                </div>
                <div class="ml-3 flex-1">
                  <h3 class="text-sm font-medium text-gray-900">赵小刚</h3>
                  <p class="text-xs text-gray-500">概率论 | 25%挂科风险</p>
                </div>
                <div class="flex-shrink-0">
                  <button class="risk-detail-btn inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 hover:bg-yellow-200">
                    详情
                  </button>
                </div>
              </div>
            </div>
            
            <div class="mt-4">
              <button class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                <i class="fa fa-line-chart mr-2"></i>
                查看完整风险报告
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-gray-200 mt-8">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <p class="text-center text-sm text-gray-500">
        © 2025 个性化学习路径的在线课程管理系统 | 版权所有
      </p>
    </div>
  </footer>

  <!-- 模态框：学习风险详情 -->
  <div id="risk-detail-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h4 class="modal-title">学习风险详情</h4>
        <button class="modal-close text-gray-400 hover:text-gray-500">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- 内容将通过JavaScript动态加载 -->
      </div>
      <div class="modal-footer">
        <button class="modal-close px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
          关闭
        </button>
        <button class="px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
          发送提醒
        </button>
      </div>
    </div>
  </div>

  <!-- 引入JavaScript -->
  <script src="../assets/js/backend.js"></script>
  <script src="../assets/js/script.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 检查用户是否已登录
      const user = backend.getCurrentUser();
      if (!backend.isLoggedIn() || !user || user.role !== 'teacher') {
        window.location.href = 'login.html';
        return;
      }
      
      // 更新欢迎信息
      const welcomeMessage = document.querySelector('h1.text-2xl');
      const welcomeSubtitle = document.querySelector('h1.text-2xl + p');
      if (welcomeMessage && welcomeSubtitle && user && user.name) {
        welcomeMessage.textContent = '教师控制面板';
        welcomeSubtitle.textContent = `欢迎回来，${user.name}！这是你的教学概览`;
      }
      
      // 更新用户头像和名称
      const userAvatar = document.querySelector('img.h-8.w-8.rounded-full.object-cover');
      const userName = document.querySelector('img.h-8.w-8.rounded-full.object-cover + span');
      if (userAvatar && userName) {
        userName.textContent = user.name;
      }
      
      // 加载教师数据
      loadTeacherData(user.id);
      
      // 加载最近活动
      loadRecentActivities(user.id);
      
      // 加载即将截止的作业
      loadUpcomingAssignments(user.id);
      
      // 加载教学数据概览
      loadTeachingOverview(user.id);
      
      // 加载学习风险预警
      loadLearningRiskWarnings(user.id);
      
      // 登出功能
      const userProfile = document.querySelector('.ml-3.relative .flex.items-center');
      if (userProfile) {
        userProfile.addEventListener('click', function() {
          if (confirm('确定要退出登录吗？')) {
            backend.logout();
            window.location.href = 'login.html';
          }
        });
      }
    });
    
    // 加载教师基本数据
    async function loadTeacherData(teacherId) {
      try {
        // 显示加载状态
        showLoadingState(true);
        
        // 并行加载多种数据
        const [coursesResult, studentsResult, assignmentsResult, riskWarningsResult] = await Promise.all([
          backend.getCourses(teacherId, 'teacher'),
          backend.getStudents(teacherId),
          backend.getAssignments(teacherId, null, 'teacher'),
          backend.getLearningRiskWarnings(teacherId)
        ]);
        
        if (coursesResult.success && studentsResult.success && assignmentsResult.success && riskWarningsResult.success) {
          const courses = coursesResult.data;
          const students = studentsResult.data;
          const assignments = assignmentsResult.data;
          const riskWarnings = riskWarningsResult.data;
          
          // 更新统计卡片
          updateStatisticsCards(courses, students, assignments, riskWarnings);
        } else {
          console.error('Failed to load teacher data');
        }
      } catch (error) {
        console.error('Error loading teacher data:', error);
      } finally {
        // 隐藏加载状态
        showLoadingState(false);
      }
    }
    
    // 更新统计卡片
    function updateStatisticsCards(courses, students, assignments, riskWarnings) {
      // 教授课程数量
      const coursesCountElement = document.querySelector('.grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4.gap-6 .dashboard-card:nth-child(1) .text-lg.font-semibold');
      if (coursesCountElement) {
        coursesCountElement.textContent = courses.length;
      }
      
      // 授课学生数量
      const studentsCountElement = document.querySelector('.grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4.gap-6 .dashboard-card:nth-child(2) .text-lg.font-semibold');
      if (studentsCountElement) {
        studentsCountElement.textContent = students.length;
      }
      
      // 待批改作业数量
      const pendingAssignmentsElement = document.querySelector('.grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4.gap-6 .dashboard-card:nth-child(3) .text-lg.font-semibold');
      if (pendingAssignmentsElement) {
        const pendingAssignments = assignments.filter(assignment => 
          assignment.status === 'active' && assignment.submissions.some(sub => sub.status === 'submitted')
        );
        pendingAssignmentsElement.textContent = pendingAssignments.length;
      }
      
      // 风险预警数量
      const riskWarningsElement = document.querySelector('.grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4.gap-6 .dashboard-card:nth-child(4) .text-lg.font-semibold');
      if (riskWarningsElement) {
        riskWarningsElement.textContent = riskWarnings.length;
      }
    }
    
    // 加载最近活动
    async function loadRecentActivities(teacherId) {
      try {
        const activitiesResult = await backend.getRecentActivities(teacherId, 'teacher');
        
        if (activitiesResult.success) {
          const activities = activitiesResult.data;
          
          // 更新最近活动列表
          updateRecentActivitiesList(activities);
        } else {
          console.error('Failed to load recent activities');
        }
      } catch (error) {
        console.error('Error loading recent activities:', error);
      }
    }
    
    // 更新最近活动列表
    function updateRecentActivitiesList(activities) {
      const activitiesList = document.querySelector('.flow-root ul');
      if (activitiesList) {
        // 清空现有内容
        activitiesList.innerHTML = '';
        
        // 添加活动项
        activities.forEach(activity => {
          const activityItem = document.createElement('li');
          activityItem.className = 'py-4';
          activityItem.innerHTML = `
            <div class="flex items-start space-x-3">
              <div class="flex-shrink-0">
                <img class="h-8 w-8 rounded-full object-cover" src="${activity.userAvatar || 'https://picsum.photos/id/' + (activity.userId % 100) + '/200/200'}" alt="${activity.userName}">
              </div>
              <div class="min-w-0 flex-1">
                <p class="text-sm text-gray-700">
                  <a href="teacher_students.html?studentId=${activity.userId}" class="font-medium text-gray-900">${activity.userName}</a>
                  ${activity.action}
                  ${activity.course ? `<a href="teacher_courses.html?courseId=${activity.courseId}" class="font-medium text-primary">《${activity.course}》</a>` : ''}
                </p>
                <p class="text-sm text-gray-500 mt-1">${activity.time}</p>
              </div>
            </div>
          `;
          
          activitiesList.appendChild(activityItem);
        });
        
        // 添加分隔线
        const listItems = activitiesList.querySelectorAll('li');
        for (let i = 0; i < listItems.length - 1; i++) {
          listItems[i].className = 'py-4 border-b border-gray-200';
        }
      }
    }
    
    // 加载即将截止的作业
    async function loadUpcomingAssignments(teacherId) {
      try {
        const assignmentsResult = await backend.getUpcomingAssignments(teacherId);
        
        if (assignmentsResult.success) {
          const assignments = assignmentsResult.data;
          
          // 更新即将截止的作业列表
          updateUpcomingAssignmentsList(assignments);
        } else {
          console.error('Failed to load upcoming assignments');
        }
      } catch (error) {
        console.error('Error loading upcoming assignments:', error);
      }
    }
    
    // 更新即将截止的作业列表
    function updateUpcomingAssignmentsList(assignments) {
      const assignmentsContainer = document.querySelector('.space-y-4');
      if (assignmentsContainer) {
        // 清空现有内容
        assignmentsContainer.innerHTML = '';
        
        // 添加作业项
        assignments.forEach(assignment => {
          const assignmentItem = document.createElement('div');
          assignmentItem.className = 'flex items-center p-3 bg-gray-50 rounded-md';
          
          // 确定截止状态样式
          let dueDateStatus = '';
          let dueDateColor = 'yellow';
          
          if (assignment.dueDate === '明天截止') {
            dueDateStatus = '明天截止';
            dueDateColor = 'red';
          } else if (assignment.dueDate === '后天截止') {
            dueDateStatus = '后天截止';
            dueDateColor = 'yellow';
          } else {
            dueDateStatus = assignment.dueDate;
            dueDateColor = 'green';
          }
          
          assignmentItem.innerHTML = `
            <div class="flex-shrink-0 bg-${dueDateColor}-100 rounded-full p-2">
              <i class="fa fa-file-text-o text-${dueDateColor}-600"></i>
            </div>
            <div class="ml-4 flex-1">
              <h3 class="text-sm font-medium text-gray-900">${assignment.title}</h3>
              <p class="text-xs text-gray-500">${assignment.course} | 截止日期：${assignment.deadline}</p>
            </div>
            <div class="flex-shrink-0">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${dueDateColor}-100 text-${dueDateColor}-800">
                ${dueDateStatus}
              </span>
            </div>
          `;
          
          assignmentsContainer.appendChild(assignmentItem);
        });
      }
    }
    
    // 加载教学数据概览
    async function loadTeachingOverview(teacherId) {
      try {
        const overviewResult = await backend.getTeachingOverview(teacherId);
        
        if (overviewResult.success) {
          const overview = overviewResult.data;
          
          // 更新教学数据概览
          updateTeachingOverviewData(overview);
          
          // 绘制教学数据图表
          drawTeachingDataChart(overview.chartData);
        } else {
          console.error('Failed to load teaching overview');
        }
      } catch (error) {
        console.error('Error loading teaching overview:', error);
      }
    }
    
    // 更新教学数据概览
    function updateTeachingOverviewData(overview) {
      const dataItems = document.querySelectorAll('.grid.grid-cols-2.gap-4 .bg-gray-50.rounded-md.p-3');
      
      if (dataItems.length >= 4) {
        // 平均出勤率
        dataItems[0].querySelector('p.text-lg.font-semibold.text-gray-900').textContent = `${overview.attendanceRate}%`;
        
        // 作业提交率
        dataItems[1].querySelector('p.text-lg.font-semibold.text-gray-900').textContent = `${overview.submissionRate}%`;
        
        // 平均测验成绩
        dataItems[2].querySelector('p.text-lg.font-semibold.text-gray-900').textContent = overview.averageScore;
        
        // 互动参与度
        dataItems[3].querySelector('p.text-lg.font-semibold.text-gray-900').textContent = `${overview.interactionRate}%`;
      }
    }
    
    // 绘制教学数据图表
    function drawTeachingDataChart(chartData) {
      const chartContainer = document.querySelector('.h-64.relative');
      if (chartContainer) {
        // 清空现有内容
        chartContainer.innerHTML = '';
        
        // 创建SVG图表
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '100%');
        svg.setAttribute('height', '100%');
        svg.setAttribute('viewBox', '0 0 300 200');
        
        // 如果有数据，绘制图表
        if (chartData && chartData.length > 0) {
          // 计算坐标点
          const points = chartData.map((point, index) => {
            const x = (index / (chartData.length - 1)) * 300;
            const y = 180 - (point.value / 100) * 120; // 从180开始向下减少
            return { x, y, value: point.value };
          });
          
          // 绘制填充区域
          const areaPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          let areaPathData = `M0,180 L${points.map(p => `${p.x},${p.y}`).join(' L')} L300,180 Z`;
          areaPath.setAttribute('d', areaPathData);
          areaPath.setAttribute('fill', 'rgba(67, 97, 238, 0.1)');
          areaPath.setAttribute('stroke', 'none');
          svg.appendChild(areaPath);
          
          // 绘制线
          const linePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          let linePathData = `M${points[0].x},${points[0].y} ${points.slice(1).map(p => `L${p.x},${p.y}`).join(' ')}`;
          linePath.setAttribute('d', linePathData);
          linePath.setAttribute('fill', 'none');
          linePath.setAttribute('stroke', '#4361ee');
          linePath.setAttribute('stroke-width', '2');
          linePath.setAttribute('stroke-linecap', 'round');
          linePath.setAttribute('stroke-linejoin', 'round');
          svg.appendChild(linePath);
          
          // 绘制数据点
          points.forEach(point => {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', point.x);
            circle.setAttribute('cy', point.y);
            circle.setAttribute('r', '3');
            circle.setAttribute('fill', '#4361ee');
            svg.appendChild(circle);
          });
          
          // 添加X轴标签
          const labelPositions = [0, 0.25, 0.5, 0.75, 1];
          labelPositions.forEach((pos, index) => {
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', pos * 300);
            label.setAttribute('y', '195');
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('font-size', '10');
            label.setAttribute('fill', '#6b7280');
            
            // 根据数据长度决定显示的标签
            if (chartData.length >= 5) {
              const labelIndex = Math.floor(pos * (chartData.length - 1));
              label.textContent = chartData[labelIndex].label;
            } else {
              // 简单标签
              const labels = ['第1周', '第3周', '第5周', '第7周', '第9周'];
              label.textContent = labels[index];
            }
            
            svg.appendChild(label);
          });
          
          // 添加Y轴标签
          for (let i = 0; i <= 3; i++) {
            const value = 25 + i * 25;
            const y = 180 - (value / 100) * 120;
            
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', '10');
            label.setAttribute('y', y);
            label.setAttribute('text-anchor', 'end');
            label.setAttribute('font-size', '10');
            label.setAttribute('fill', '#6b7280');
            label.setAttribute('dominant-baseline', 'middle');
            label.textContent = `${value}%`;
            
            svg.appendChild(label);
          }
        }
        
        chartContainer.appendChild(svg);
      }
    }
    
    // 加载学习风险预警
    async function loadLearningRiskWarnings(teacherId) {
      try {
        const riskWarningsResult = await backend.getLearningRiskWarnings(teacherId);
        
        if (riskWarningsResult.success) {
          const riskWarnings = riskWarningsResult.data;
          
          // 更新学习风险预警列表
          updateLearningRiskWarningsList(riskWarnings);
          
          // 添加风险详情按钮事件
          addRiskDetailButtonEvents(riskWarnings);
        } else {
          console.error('Failed to load learning risk warnings');
        }
      } catch (error) {
        console.error('Error loading learning risk warnings:', error);
      }
    }
    
    // 更新学习风险预警列表
    function updateLearningRiskWarningsList(riskWarnings) {
      const riskWarningsContainer = document.querySelector('.bg-white.rounded-lg.shadow-md.overflow-hidden:last-child .p-6 .space-y-4');
      if (riskWarningsContainer) {
        // 清空现有内容
        riskWarningsContainer.innerHTML = '';
        
        // 添加风险预警项
        riskWarnings.forEach(warning => {
          const riskItem = document.createElement('div');
          
          // 确定风险等级样式
          let riskLevelClass = 'yellow';
          let riskLevelText = `${warning.riskPercentage}%挂科风险`;
          
          if (warning.riskPercentage >= 30) {
            riskLevelClass = 'red';
          } else if (warning.riskPercentage >= 20) {
            riskLevelClass = 'yellow';
          } else {
            riskLevelClass = 'green';
          }
          
          riskItem.className = `flex items-center p-3 bg-${riskLevelClass}-50 rounded-md`;
          riskItem.innerHTML = `
            <div class="flex-shrink-0">
              <img class="h-8 w-8 rounded-full object-cover" src="${warning.studentAvatar || 'https://picsum.photos/id/' + (warning.studentId % 100) + '/200/200'}" alt="${warning.studentName}">
            </div>
            <div class="ml-3 flex-1">
              <h3 class="text-sm font-medium text-gray-900">${warning.studentName}</h3>
              <p class="text-xs text-gray-500">${warning.courseName} | ${riskLevelText}</p>
            </div>
            <div class="flex-shrink-0">
              <button data-student-id="${warning.studentId}" data-course-id="${warning.courseId}" class="risk-detail-btn inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-${riskLevelClass}-100 text-${riskLevelClass}-800 hover:bg-${riskLevelClass}-200">
                详情
              </button>
            </div>
          `;
          
          riskWarningsContainer.appendChild(riskItem);
        });
      }
    }
    
    // 添加风险详情按钮事件
    function addRiskDetailButtonEvents(riskWarnings) {
      // 首先移除现有的事件监听器（避免重复添加）
      const buttons = document.querySelectorAll('.risk-detail-btn');
      buttons.forEach(button => {
        const newButton = button.cloneNode(true);
        button.parentNode.replaceChild(newButton, button);
        
        newButton.addEventListener('click', function() {
          const studentId = this.getAttribute('data-student-id');
          const courseId = this.getAttribute('data-course-id');
          showRiskDetail(studentId, courseId);
        });
      });
    }
    
    // 显示风险详情
    async function showRiskDetail(studentId, courseId) {
      try {
        const riskDetailResult = await backend.getLearningRiskDetail(studentId, courseId);
        
        if (riskDetailResult.success) {
          const riskDetail = riskDetailResult.data;
          
          // 获取模态框
          const modal = document.getElementById('risk-detail-modal');
          const modalBody = modal.querySelector('.modal-body');
          
          if (modalBody) {
            // 填充模态框内容
            modalBody.innerHTML = `
              <div class="mb-4 flex items-center">
                <img class="h-12 w-12 rounded-full object-cover mr-4" src="${riskDetail.studentAvatar || 'https://picsum.photos/id/' + (studentId % 100) + '/200/200'}" alt="${riskDetail.studentName}">
                <div>
                  <h3 class="text-lg font-medium text-gray-900">${riskDetail.studentName}</h3>
                  <p class="text-sm text-gray-600">${riskDetail.courseName}</p>
                </div>
                <div class="ml-auto">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-${getRiskLevelClass(riskDetail.riskPercentage)}-100 text-${getRiskLevelClass(riskDetail.riskPercentage)}-800">
                    ${riskDetail.riskPercentage}%挂科风险
                  </span>
                </div>
              </div>
              
              <div class="mb-4">
                <h4 class="text-sm font-medium text-gray-900 mb-2">学习表现分析</h4>
                <div class="grid grid-cols-2 gap-3">
                  <div class="bg-gray-50 p-3 rounded-md">
                    <p class="text-xs text-gray-500">出勤率</p>
                    <p class="text-lg font-medium text-gray-900">${riskDetail.attendance}%</p>
                  </div>
                  <div class="bg-gray-50 p-3 rounded-md">
                    <p class="text-xs text-gray-500">作业完成率</p>
                    <p class="text-lg font-medium text-gray-900">${riskDetail.homeworkCompletion}%</p>
                  </div>
                  <div class="bg-gray-50 p-3 rounded-md">
                    <p class="text-xs text-gray-500">平均测验成绩</p>
                    <p class="text-lg font-medium text-gray-900">${riskDetail.testScores}</p>
                  </div>
                  <div class="bg-gray-50 p-3 rounded-md">
                    <p class="text-xs text-gray-500">参与度</p>
                    <p class="text-lg font-medium text-gray-900">${riskDetail.participation}%</p>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <h4 class="text-sm font-medium text-gray-900 mb-2">风险因素</h4>
                <ul class="list-disc pl-5 space-y-1">
                  ${riskDetail.riskFactors.map(factor => `<li class="text-sm text-gray-700">${factor}</li>`).join('')}
                </ul>
              </div>
              
              <div>
                <h4 class="text-sm font-medium text-gray-900 mb-2">改进建议</h4>
                <ul class="list-disc pl-5 space-y-1">
                  ${riskDetail.suggestions.map(suggestion => `<li class="text-sm text-gray-700">${suggestion}</li>`).join('')}
                </ul>
              </div>
            `;
          }
          
          // 显示模态框
          modal.style.display = 'flex';
          
          // 添加发送提醒按钮事件
          const sendReminderButton = modal.querySelector('.modal-footer button:last-child');
          if (sendReminderButton) {
            sendReminderButton.addEventListener('click', function() {
              sendRiskReminder(studentId, courseId);
            });
          }
        }
      } catch (error) {
        console.error('Error loading risk detail:', error);
        alert('加载风险详情失败，请稍后重试');
      }
    }
    
    // 获取风险等级样式类
    function getRiskLevelClass(percentage) {
      if (percentage >= 30) return 'red';
      if (percentage >= 20) return 'yellow';
      return 'green';
    }
    
    // 发送风险提醒
    async function sendRiskReminder(studentId, courseId) {
      try {
        const result = await backend.sendRiskReminder(studentId, courseId);
        
        if (result.success) {
          alert('风险提醒已发送');
          
          // 关闭模态框
          const modal = document.getElementById('risk-detail-modal');
          if (modal) {
            modal.style.display = 'none';
          }
        } else {
          alert('发送失败，请稍后重试');
        }
      } catch (error) {
        console.error('Error sending risk reminder:', error);
        alert('发送失败，请稍后重试');
      }
    }
    
    // 显示加载状态
    function showLoadingState(show) {
      const mainContent = document.querySelector('main');
      let loadingElement = document.getElementById('loading-overlay');
      
      if (show) {
        if (!loadingElement) {
          loadingElement = document.createElement('div');
          loadingElement.id = 'loading-overlay';
          loadingElement.className = 'fixed inset-0 bg-white bg-opacity-80 z-50 flex items-center justify-center';
          loadingElement.innerHTML = `
            <div class="text-center">
              <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
              <p class="mt-4 text-gray-600">加载中...</p>
            </div>
          `;
          document.body.appendChild(loadingElement);
        } else {
          loadingElement.style.display = 'flex';
        }
        
        if (mainContent) {
          mainContent.style.opacity = '0.5';
        }
      } else {
        if (loadingElement) {
          loadingElement.style.display = 'none';
        }
        
        if (mainContent) {
          mainContent.style.opacity = '1';
        }
      }
    }
    
    // 模态框关闭事件
    document.querySelectorAll('.modal-close').forEach(button => {
      button.addEventListener('click', function() {
        const modal = this.closest('.modal');
        if (modal) {
          modal.style.display = 'none';
        }
      });
    });
    
    // 点击模态框外部关闭
    window.addEventListener('click', function(event) {
      document.querySelectorAll('.modal').forEach(modal => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>